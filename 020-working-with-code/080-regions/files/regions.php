<?php

function addRows(array $data): array
{
    $result = [];

    //region 1. Add row only once for the same surveyId/sessionId
    foreach ($data as $participant) {
        // A few dozen lines of code...
        // A few dozen lines of code...
        // A few dozen lines of code...
    }

    //endregion

    //region 2. Add new participants
    try {
        // A few dozen lines of code...
        // A few dozen lines of code...
        // A few dozen lines of code...
    } catch (\Exception $e) {
        // Handle the exception
    }

    //endregion

    //region 3. Prepare resulting array
    // A few dozen lines of code...
    // A few dozen lines of code...
    // A few dozen lines of code...
    // A few dozen lines of code...
    //endregion

    return $result;
}
